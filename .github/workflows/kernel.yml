on: [ workflow_dispatch ]
jobs:
  kernel:
    runs-on: "ubuntu-20.04"
    steps:
      - uses: actions/checkout@v3
      - name: sudo apt -yqq update && sudo apt -yqq install
        run: sudo apt -yqq update && sudo apt -yqq install python3 bison flex make gcc g++ wget curl git
      - name: toolchain
        run: cd Kernel && mkdir toolchain && mkdir toolchain/gcc && mkdir toolchain/gcc/linux-x86 && mkdir toolchain/gcc/linux-x86/aarch64 && mkdir toolchain/gcc/linux-x86/aarch64/aarch64-linux-android-4.9 && cd toolchain/gcc/linux-x86/aarch64/aarch64-linux-android-4.9 && curl https://android.googlesource.com/platform/prebuilts/gcc/linux-x86/aarch64/aarch64-linux-android-4.9/+archive/0a0604336d4d1067aa1aaef8d3779b31fcee841d.tar.gz | gunzip | tar x && cd ../../../.. && mkdir llvm-arm-toolchain-ship && git clone --depth=1 https://github.com/gro-w/Snapdragon-LLVM llvm-arm-toolchain-ship/10.0 && cd ..
      - name: make_kernel
        run: |
          cd Kernel
          #dd if=../Makefile.wno-error of=./Makefile
          dd if=../config_docker of=./arch/arm64/configs/bloomq_kor_single_defconfig
          bash build_kernel.sh
          mv out/source ~
          cd ..
      
      - name: artifact
        uses: actions/upload-artifact@v3
        with:
          name: out
          path: Kernel/out
          retention-days: 1
